# 自动创建设备文件

以平台驱动程序global_fifo 为例子，在globalfifo_probe中增加
```c
static int globalfifo_probe(struct platform_device* pdev)
{
    //......
    for (i = 0; i < DEVICE_NUM; i++)
	{
		dev = globalfifo_devp + i;
		devno = MKDEV(globalfifo_major, i);
		
		mutex_init(&dev->mutex);
		init_waitqueue_head(&dev->r_wait);
		init_waitqueue_head(&dev->w_wait);
		cdev_init(&dev->cdev, &globalfifo_fops);
		dev->cdev.owner = THIS_MODULE;
		err = cdev_add(&dev->cdev, devno, 1);
		if (err)
		{
			printk(KERN_NOTICE "Error:%d adding globalmen:%d", err, i);
		}
	}

    // 创建设备文件
    pClass = class_create(THIS_MODULE, "globalfifo"); // 设备名与register_chrdev_region入参一致
    if (IS_ERR(pClass)) {
        pr_err("Failed to create class\n");
        ret = PTR_ERR(pClass);
        goto fail_class;
    }

    for (i = 0; i < DEVICE_NUM; i++)
    {
        devno = MKDEV(globalfifo_major, i);
        pdevf = device_create(pClass, NULL, devno, NULL, "globalfifo%d", i);
        if(IS_ERR(pdevf)) {
            pr_err("Failed to create device\n");
            ret = PTR_ERR(pdevf);
            goto fail_dev;
            
        }
    }
    //......
}
```