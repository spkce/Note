# ARP
ARP（Address Resolution Protocol）即地址解析协议， 用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址。

# ARP 请求及响应
在同一个链路
主机 A 想要获取主机 B 的 MAC 地址，通过主机 A 会通过广播 的方式向以太网上的所有主机发送一个 ARP 请求包，这个 ARP 请求包中包含了主机 A 想要知道的主机 B 的 IP 地址的 MAC 地址。
主机 A 发送的 ARP 请求包会被同一链路上的所有主机/路由器接收并进行解析。每个主机/路由器都会检查 ARP 请求包中的信息，如果 ARP 请求包中的目标 IP 地址 和自己的相同，就会将自己主机的 MAC 地址写入响应包返回主机 A

### 代理ARP
在不同链路，通常ARP会被路由器隔离，但是采用代理 ARP (ARP Proxy) 的路由器可以将 ARP 请求转发给临近的网段。使多个网段中的节点像是在同一网段内通信。

### ARP 缓存
为了提高效率，主机会维护一个 ARP 缓存，用于存储 IP 地址和 MAC 地址的映射。ARP 缓存的条目通常有一个过期时间，以便在地址发生变化时能够及时更新。
# ARP 报文

```
+---------+--------+------------+------------+------+----------+---------+-----------+-----------+
| 硬件类型 | 协议类型 | 硬件地址长度 | 协议地址长度 | 操作 | 源mac地址 | 源ip地址 | 目的mac地址 | 目的ip地址 |
+---------+--------+------------+------------+------+----------+---------+-----------+-----------+
```


字段 | Byte | 说明
---------|----------|---------
硬件类型|	2 |	表示物理地址的类型，对于以太网 MAC 地址，值为：0x0001
协议类型|	2 |	发送方要映射的协议地址类型，对于 IP 地址，值为：0x0800
硬件地址长度|	1 |	以太网 MAC 地址，占用 6 个字节，所以值为：0x06
协议地址长度|	1 |	IPv4，占用 4 字节，所以值为：0x04
操作|	2 |	4种操作类型：ARP 请求，值为：0x0001；ARP 应答，值为：0x0002；RARP 请求，值为：0x0003；RARP 应答，值为：0x0004
源MAC地址|	6 |	发送方的 MAC 地址
源IP地址|	4 |	发送方的 IP 地址
目的MAC地址|	6 |	接收方的 MAC 地址，对于 ARP 请求，不知道接收方的 MAC 地址，该值用 0 填充，即 0x0000 0000 0000
目的IP地址|	4 |	接收方的 IP 地址

# 免费arp
当设备端口配置IP地址时，都会连续发送三次免费ARP来判断自己所配地址在广播域内是否冲突（如果没有收到免费ARP应答，则表示此地址不冲突）

免费ARP请求：源ip地址和目的ip地址都是请求发送者自己，源mac地址为请求发送者地址，目标mac地址为0

免费ARP响应：源ip地址和目的ip地址都是响应发送者，源mac地址为响应发送者地址，目标mac地址为ff:ff:ff:ff:ff:ff