# 下载

vtk 文档：https://docs.vtk.org/en/latest/build_instructions/build_settings.html#

下载地址: https://vtk.org/download/

gitlab: https://gitlab.kitware.com/vtk/vtk

# VTK-9.3.1 编译

```
//使用openGLES EGL
mkdir build
cd build
cmake  -DVTK_USE_X=OFF -DVTK_USE_COCOA=OFF -DVTK_USE_X=OFF -DVTK_OPENGL_USE_GLES=ON  -DVTK_OPENGL_HAS_EGL=ON ..
make -j32
```
这样没有UI的事件循环，顾需要搭配qt
# VTK-9.3.1 错误

```
/opt/VTK-9.3.1/Rendering/LICOpenGL2/vtkLineIntegralConvolution2D.cxx: In member function 'vtkTextureObject* vtkLICPingPongBufferManager::AllocateLICBuffer(vtkOpenGLRenderWindow*, unsigned int*)':
/opt/VTK-9.3.1/Rendering/LICOpenGL2/vtkLineIntegralConvolution2D.cxx:552:70: error: 'ClampToBorder' is not a member of 'vtkTextureObject'
  552 |       context, texSize, vtkTextureObject::Nearest, vtkTextureObject::ClampToBorder, border);
```
VTK 9.x版本对OpenGL ES的支持有重大调整，ClampToBorder在GLES2/3中可能被移除或替换为ClampToEdge

ClampToBorder 改为 ClampToEdge
```
/opt/VTK-9.3.1/Rendering/CellGrid/vtkDGOpenGLRenderer.cxx:1052:25: error: 'GL_TEXTURE_CUBE_MAP_SEAMLESS' was not declared in this scope; did you mean 'GL_TEXTURE_CUBE_MAP_NEGATIVE_X'?
 1052 |     ostate->vtkglEnable(GL_TEXTURE_CUBE_MAP_SEAMLESS);
```
GL_TEXTURE_CUBE_MAP_SEAMLESS 改为 0x884F


# vtk依赖qt
```
#qt5
cmake ..  -DVTK_USE_X=OFF -DVTK_USE_COCOA=OFF -DVTK_OPENGL_USE_GLES=ON  -DVTK_OPENGL_HAS_EGL=ON -DVTK_USE_TK=OFF -DBUILD_SHARED_LIBS=ON -DVTK_GROUP_ENABLE_Qt=YES -DVTK_QT_VERSION=5 -DQt5_DIR=/opt/out/lib/cmake/Qt5 -DCMAKE_PREFIX_PATH=/opt/out -DCMAKE_INSTALL_PREFIX:PATH=/opt/vtk_out -DVTK_DEBUG_MODULE=ON -DCMAKE_BUILD_TYPE=Debug

#qt6
cmake ..  -DVTK_USE_X=OFF -DVTK_USE_COCOA=OFF -DVTK_OPENGL_USE_GLES=ON  -DVTK_OPENGL_HAS_EGL=ON -DVTK_USE_TK=OFF -DBUILD_SHARED_LIBS=ON -DVTK_GROUP_ENABLE_Qt=YES -DVTK_QT_VERSION=6 -DQt6_DIR=/opt/out/lib/cmake/Qt6 -DCMAKE_PREFIX_PATH=/opt/out -DCMAKE_INSTALL_PREFIX:PATH=/opt/vtk_out -DVTK_DEBUG_MODULE=ON -DCMAKE_BUILD_TYPE=Debug
```

# 验证程序
```c++
#include <QApplication>
#include <QSurfaceFormat>
#include <QVTKOpenGLNativeWidget.h>
#include <vtkConeSource.h>
#include <vtkPolyDataMapper.h>
#include <vtkActor.h>
#include <vtkRenderer.h>
#include <vtkGenericOpenGLRenderWindow.h>

int main(int argc, char** argv)
{
    // 配置GLES上下文
    QSurfaceFormat format;
    format.setRenderableType(QSurfaceFormat::OpenGLES);
    format.setVersion(3, 2);
    QSurfaceFormat::setDefaultFormat(format);

    QApplication app(argc, argv);
    
    // 创建VTK部件
    QVTKOpenGLNativeWidget widget;
    widget.resize(800, 600);

    // 设置EGL后端
    vtkNew<vtkGenericOpenGLRenderWindow> renderWindow;

    renderWindow->SetWindowName("OpenGLES");
    widget.setRenderWindow(renderWindow);

    // 创建VTK管线
    vtkNew<vtkConeSource> cone;
    vtkNew<vtkPolyDataMapper> mapper;
    mapper->SetInputConnection(cone->GetOutputPort());
    
    vtkNew<vtkActor> actor;
    actor->SetMapper(mapper);
    
    vtkNew<vtkRenderer> renderer;
    renderer->AddActor(actor);
    renderer->SetBackground(0.2, 0.3, 0.4);
    renderWindow->AddRenderer(renderer);

    widget.show();
    return app.exec();
}

```
```makefile
# 编译器配置
CXX = g++
CXXFLAGS = -std=c++17 -fPIC -g \
           -I/opt/vtk_out/include/vtk-9.3 \
           -I/opt/out/include/ \
           -I/opt/out/include/QtCore/ \
           -I/opt/out/include/QtGui \
           -I/opt/out/include/QtWidgets \
           -I/opt/out/include/QtOpenGL \
           -I/opt/out/include/QtOpenGLWidgets

# 链接库配置
LDFLAGS = -L/opt/out/lib \
          -L/opt/vtk_out/lib \
          -lvtkGUISupportQt-9.3 \
          -lvtkRenderingCore-9.3 \
          -lvtkCommonCore-9.3 \
          -lvtkRenderingOpenGL2-9.3 \
          -lvtkInteractionStyle-9.3 \
          -lvtkFiltersSources-9.3 \
          -lvtkCommonColor-9.3 \
          -lvtkCommonExecutionModel-9.3 \
          -lvtksys-9.3 \
          -lQt6Core \
          -lQt6Gui \
          -lQt6Widgets \
          -lQt6OpenGL \
          -lQt6OpenGLWidgets \
          -lGLESv2 -lEGL

# 目标文件
OBJS = main.o 

# 最终可执行文件
TARGET = vtk_qt_app

all: $(TARGET)

$(TARGET): $(OBJS)
    $(CXX) -o $@ $^ $(LDFLAGS)

%.o: %.cpp
    $(CXX) $(CXXFLAGS) -c $< -o $@

clean:
    rm -f $(OBJS) $(TARGET)

```